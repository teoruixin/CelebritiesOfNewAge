<html>

<meta charset="utf-8" />
<head>
<title></title>
<style>
h1 {
  font-family: sans-serif;
  text-align: center;
}

svg {
  display: block;
  margin-left: auto;
  margin-right: auto;
  border: 1px solid black;
}

svg text {
  font-size: 11px;
  font-family: sans-serif;
  text-anchor: middle;
  fill: black;
}

</style>
<script src="https://d3js.org/d3.v7.min.js" charset="utf-8"></script>
</head>

<body>
<h1>Average Monthly Earnings vs Views last 30 days (for each channel) </h1>
<svg class="chart"></svg>

<script>
var chartWidth = 500;
var chartHeight = 500;

/********
 * Data *
 ********/

var allData;

/**************
 * Load Data  *
 **************/

var index = 0;

d3.csv("data/Global Youtube Statistics.csv", (row, i) => {
  return {
    youtuber: row.Youtuber,
    viewsDays: +row.video_views_for_the_last_30_days,
    HighestEarning: +row.highest_monthly_earnings,
    LowestEarning: +row.lowest_monthly_earnings,
    AverageEarning: (+row.highest_monthly_earnings + +row.lowest_monthly_earnings) / 2,
  };
}).then(rows => {
  allData = rows;
  makeChart(rows);
}).catch(error => {
  console.log(error);
});

/**********
 * Scales *
 **********/
var x,y;


/********
 * Axes *
 ********/

var xAxis;
var yAxis;

/**************
 * Make Chart *
 **************/

function makeChart(data){
  data = data.filter(function(d) {
    return !isNaN(d.viewsDays);
  });

  // y position
  y = d3.scaleLinear()
      .domain(d3.extent(allData,function(d){ return d.viewsDays; }))
      .range([chartHeight-75, 50]);

  // x position
  x = d3.scaleLinear()
      .domain(d3.extent(allData,function(d){ return d.AverageEarning; }))
      .range([100,chartWidth-25]);

  var canvas = d3.select(".chart")
      .style("width",chartWidth)
      .style("height",chartHeight);

  var scatter = d3.select(".chart").selectAll("circle")
      .data(data);

  //tooltip
  var tooltip = d3.select(".chart")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "1px")
    .style("border-radius", "5px")
    .style("padding", "10px")

  //ENTER
  var enter = scatter.enter().append("circle")
      .attr("fill-opacity",0)
      .attr("cx", function(d) { return x(d.AverageEarning); })
      .attr("cy", function(d) { return y(d.viewsDays); })
      .attr("r",function(d){ return 5;})
      .attr("stroke", "steelblue") 
      .attr("stroke-width","1px")
    .on("mouseover", function(event, d){ 
      d3.select(this).transition()
          .attr("stroke-width", "5px")
          .attr("r", 7);
        tooltip.transition()
          .duration(100)
          .style("opacity", 1);
    })
    .on("mouseout", function(event, d){ 
      d3.select(this).transition()
        .attr("stroke-width", "1px")
        .attr("r",5);

        tooltip.transition()
          .duration('200')
          .style("opacity", 0);
    });

  // Add a title to the point (on mouseover)
  enter.append("svg:title")
    .text(function(d){ 
        return "Youtuber: " + d.youtuber + "\n" +
               "Video views: " + d.viewsDays + "\n" +
               "Average earnings: " + d.AverageEarning + "\n"
    });

  //ENTER + UPDATE
  enter.merge(scatter)
      .attr("cx",function(d){ return x(d.AverageEarning); })
      .attr("cy",function(d){ return y(d.viewsDays);});

  xAxis = d3.axisBottom()
      .scale(x);

  yAxis = d3.axisLeft()
      .scale(y);

  var yAxisGroup = canvas.append("g")
      .attr("class","axis")
      .attr("transform","translate(100,0)")
      .call(yAxis);

  yAxisGroup.selectAll("text")
      .attr("transform", "translate(-35,0)");

  yAxisGroup.append("text")
      .text("Video Views for the Last 30 Days")
      .style("font-weight", "bold")
      .attr("transform", "rotate(-90)")
      .attr("y", -85)
      .attr("dx", -200)
      .style("text-anchor", "end");

  var xAxisGroup = canvas.append("g")
    .attr("class","axis")
    .attr("transform","translate(0,"+(chartHeight-75)+")")
    .call(xAxis);

  xAxisGroup.selectAll("text")
    .attr("transform", "rotate(-45)")
    .style("text-anchor", "end")
    .attr("dy", "0.35em");

  canvas.append("text")
    .attr("class", "x-axis-label")
    .attr("text-anchor", "middle")
    .attr("x", chartWidth / 2 + 30)
    .attr("y", chartHeight - 10)
    .text("Average Monthly Income")
    .style("font-weight", "bold");
}

</script>
</body>
</html>
